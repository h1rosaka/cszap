

WALってログのデータ量とか問題にないの？
書き込みの時のクライアントから受け取ったデータ量が最大だから、そんな問題ない。
WALを大量のレプリカに送りたい、とかの特殊な場合は、分散ファイルシステムにログ置いて読みにいくとかにする



p173
結果整合性
その内一致する、がその内がいつなのかはわざと曖昧にしてある　10年後かも
銀行とかは使わない。多分
gのデータベースは結構結果整合性
デフォルトが結果整合性
読み取りするときに、このくらいの強さのconsistencyでお願いしますと指定できる。
結果整合性の時は、レスポンスが速く、失敗しにくい。
高い整合性を求めてリクエスト送った時は、遅いし、失敗するかもしれない。
- リーダーからデータ着てないな、待とう。タイムアウト。みたいになる。
 - リクエストの時点でタイムスタンプというかログIDみたいなの送って、俺この書き込みしたからこれより新しい世界を見せてね、と言ってそれに対応するものをもらいにいくイメージ
メガストア　app engineの裏側　結果整合性
- サーバー再起動中は数ヶ月前のログからずっと再現し直すので、だいぶ前のデータが帰ったりする
- これも結果整合性といえば整合性だが、、、古すぎてみんなびっくり




p174
- read-after-writeのところ、みんなが編集するようなものの場合どうする？
    - ここはあくまで自分が書いたものがその直後に見えるか、というだけなので、他の人が編集したものがすぐ見れることは保証してない


p175
- ユーザーを覚えておくデータベース
    - 台湾のDCと日本のDCで、たまたま今だけ台湾旅行中のユーザーだったとしても普段日本のDC使っってるなら、書き込みの際ルーティングをそっちにする


RTGS
- 青銀行 → 緑銀行 お金送る
    - 送るときに青銀行にお金あること：青銀行が確認
    - 15時に全部集計して日銀に持っていく
        - 青銀行から、どこの銀行にいくら渡しますの情報を渡す
        - 日銀は全部を足し引きして、netの差分の動きを計算
        - 日銀の中の青銀行口座→緑銀行口座
        - 青から大量にお金送る人がいて、足りなくなったら青銀行破産
            - 日銀に青銀行口座に1兆円あって、2兆円出さないといけないと、、
                - 私が青銀行から送金した送金はキャンセルされる
                    - 1日たたないと、銀行送金は確定しない
                    - どのタイミングで確定するのか難しい
    - Rreal Time Gross Settlement
        - リアルタイム
        - 銀行が破綻してもパニックになりにくい
        - 1兆円を超えた段階で青銀行にこれ以上無理だよって日銀から通知いって、その後青銀行から引き出しできなくなる(後から)

- 教えて日銀
    - https://www.boj.or.jp/about/education/oshiete/




VISA
- インターネットがなかった頃は、カード番号メモっておいて、VISAにあとでまとめて郵送とかしてた
- 2010年ごろ、クレカの凸凹の上に紙おいて鉛筆でサラサラやって写してた



p191
- 反エントロピーで、2個ずつチェックして、欠損補填する時、全部の組み合わせ見たら組合せ爆発しないか？
- ログストリームとか見て、良い組み合わせを選んでやる


ニューレリック
どういうツールでもCPU使用率とか見るけど、そのノリで、レプリカのディレイ率を見てる
デイリーでバッチで、どのくらい古くなってるか見る
そのグラフが急に違う形になって、ずっと古いのになってたら、更新プロセス動いてなくね？みたいな話をする


p194

クロックのスキュー
- 時計ズレてることあると、最新だと思った方が実は古い方ってパターンがあるよって話

p195
- こちらもversion書いててもおかしくないが単純化してるだけかも
- versionは、v7(timstamp=XXX)となってて、v7といってもいろいろあるが、eventualに一つになる


p202
図5-13
クライアントが2人いるので、世界線を二つ保存する
2人がDBに接続しないまま書き込み続けるので、世界線を保存し続ける
マージするときに和集合をとってるのはショッピングカートだったらそれが良さそうだからであって、別のルールでも良い
そのうち一つに収束させる(世界線2つの和集合)
